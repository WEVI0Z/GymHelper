unit TrainingsStats;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons;

type
  TTrainingStatsForm = class(TForm)
    StatWrap: TScrollBox;
    TempButton: TButton;
    procedure TempButtonClick(Sender: TObject);
  private
    { Private declarations }
  public
    buttons: array of TSpeedButton;
    labels: array of TLabel;
  end;

var
  TrainingStatsForm: TTrainingStatsForm;

implementation

uses TrainingCompare, MainMenu, Authorization;

{$R *.dfm}

procedure TTrainingStatsForm.TempButtonClick(Sender: TObject);

var i, j, tempTime, tempWeights, tempTimes, tempMax, maxWeights, maxTimes, currentWeights, currentTimes: integer;

begin
  for i := 0 to length(buttons) - 1 do
    if buttons[i] = Sender then
       trainingCompare.CompareForm.currentID := i;

  trainingsStats.TrainingStatsForm.close;

  tempMax := 0;

  for i := 0 to high(users[UserID].Stats) do
  begin
    tempWeights := 0;
    tempTimes := 0;

    for j := 0 to high(users[UserID].Stats[i].Exercises) do
    begin
      tempWeights := tempWeights + users[UserID].Stats[i].Exercises[j].Weight * users[UserID].Stats[i].Exercises[j].Times;
      tempTimes := tempTimes + users[UserID].Stats[i].Exercises[j].Times;
    end;

    if tempWeights * tempTimes * users[UserID].Stats[i].Time > tempMax then
    begin
      tempMax := tempWeights * tempTimes * users[UserID].Stats[i].Time;
      trainingCompare.CompareForm.maxID := i;
      maxWeights := tempWeights;
      maxTimes := tempTimes;
    end;
  end;

  currentWeights := 0;
  currentTimes := 0;

  for i := 0 to high(users[UserID].Stats[trainingCompare.CompareForm.currentID].Exercises) do
  begin
    currentWeights := CurrentWeights + users[UserID].Stats[trainingCompare.CompareForm.currentID].Exercises[i].Weight * users[UserID].Stats[trainingCompare.CompareForm.currentID].Exercises[i].Times;
    currentTimes := CurrentTimes + users[UserID].Stats[trainingCompare.CompareForm.currentID].Exercises[i].Times
  end;

  trainingCompare.CompareForm.NameOfTheBestTraining.Caption := users[UserID].Stats[trainingCompare.CompareForm.maxID].Name + ' (' + users[UserID].Stats[trainingCompare.CompareForm.maxID].Date + ')';
  trainingCompare.CompareForm.NameOfTheCurrentTraining.Caption := users[UserID].Stats[trainingCompare.CompareForm.currentID].Name + ' (' + users[UserID].Stats[trainingCompare.CompareForm.currentID].Date + ')';

  trainingCompare.CompareForm.BestTime.Caption := intToStr(users[UserID].Stats[trainingCompare.CompareForm.maxID].Time) + ' мин - наибольшее время тренировки';
  trainingCompare.CompareForm.CurrentTime.Caption := intToStr(users[UserID].Stats[trainingCompare.CompareForm.currentID].Time) + ' мин - время тренировки в данной тренировке';

  trainingCompare.CompareForm.BestTimes.Caption := intToStr(maxTimes) + ' раз - лучшее кол-во повторений';
  trainingCompare.CompareForm.BestWeight.Caption := intToStr(maxWeights) + ' кг - лучший общий поднятый вес';

  trainingCompare.CompareForm.CurrentTimes.Caption := intToStr(currentTimes) + ' раз - кол-во повторений в данной тренировке';
  trainingCompare.CompareForm.CurrentWeight.Caption := intToStr(currentWeights) + ' кг - общий поднятый вес в данной тренировке';

  if (MaxTimes = CurrentTimes) and (MaxWeights = CurrentWeights) then
    trainingCompare.CompareForm.Score.Caption := 'Это ваша лучшая тренировка (Оценка тренировки)'
  else if (MaxTimes * 0.9 < CurrentTimes) or (MaxWeights * 0.9 < CurrentWeights) then
    trainingCompare.CompareForm.Score.Caption := 'Эта тренировка близка к вашему рекорду (Оценка тренировки)'
  else if (MaxTimes * 0.7 < CurrentTimes) or (MaxWeights * 0.7 < CurrentWeights) then
    trainingCompare.CompareForm.Score.Caption := 'Довольно неплохая тренировка для вас (Оценка тренировки)'
  else if (MaxTimes * 0.5 < CurrentTimes) or (MaxWeights * 0.5 < CurrentWeights) then
    trainingCompare.CompareForm.Score.Caption := 'На этот раз вы работали в полсилы (Оценка тренировки)'
  else if (MaxTimes * 0.3 < CurrentTimes) or (MaxWeights * 0.3 < CurrentWeights) then
    trainingCompare.CompareForm.Score.Caption := 'Разминочная тренировка (Оценка тренировки)'
  else if (MaxTimes * 0.1 < CurrentTimes) or (MaxWeights * 0.1 < CurrentWeights) then
    trainingCompare.CompareForm.Score.Caption := 'На этот раз ваша тренировка не тянет даже на разминку (Оценка тренировки)'
  else
    trainingCompare.CompareForm.Score.Caption := 'Результат тренировки практически нулевой (Оценка тренировки)';

  trainingCompare.CompareForm.Show;
end;

end.
